<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asia Expansion Intelligence Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4B4AC7'
                    }
                }
            }
        }
    </script>
    <style>
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #5D5CDE;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .institution-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .institution-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(93, 92, 222, 0.1);
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 h-full">
    <script>
        // Simple dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
    </script>

    <div class="min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900">
        <!-- Header -->
        <header class="bg-white/80 backdrop-blur-lg dark:bg-gray-800/80 shadow-lg border-b border-gray-200/50 dark:border-gray-700/50 sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-primary to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900 dark:text-white">Asia Expansion Intelligence Platform</h1>
                            <p class="text-sm text-gray-500 dark:text-gray-400">International Financial Institutions â€¢ Real-Time Intelligence</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2 text-xs">
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-gray-500 dark:text-gray-400">Live</span>
                            <span class="text-green-600 dark:text-green-400 font-medium">ACTIVE</span>
                        </div>
                        <button onclick="refreshData()" class="bg-gradient-to-r from-primary to-purple-600 hover:from-primary-dark hover:to-purple-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-lg">
                            Refresh Data
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <!-- Key Metrics Dashboard -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl shadow-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm font-medium">International Banks</p>
                            <p class="text-3xl font-bold">28</p>
                            <p class="text-blue-200 text-xs mt-1">With Asia presence</p>
                        </div>
                        <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-2xl shadow-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm font-medium">Broker Dealers</p>
                            <p class="text-3xl font-bold">8</p>
                            <p class="text-green-200 text-xs mt-1">Asia operations</p>
                        </div>
                        <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl shadow-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-sm font-medium">Fintechs</p>
                            <p class="text-3xl font-bold">12</p>
                            <p class="text-purple-200 text-xs mt-1">Asia partnerships</p>
                        </div>
                        <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl shadow-xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-100 text-sm font-medium">Total Market Cap</p>
                            <p class="text-2xl font-bold">$3.2T</p>
                            <p class="text-orange-200 text-xs mt-1">Combined value</p>
                        </div>
                        <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                <!-- Institution Directory -->
                <div class="bg-white/70 backdrop-blur-lg dark:bg-gray-800/70 rounded-2xl shadow-xl border border-gray-200/50 dark:border-gray-700/50">
                    <div class="px-6 py-4 border-b border-gray-200/50 dark:border-gray-700/50">
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                            <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                            Financial Institutions Directory
                        </h2>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Click institutions for detailed analysis</p>
                    </div>
                    <div class="p-6">
                        <div id="institutionDirectory" class="space-y-3">
                            <!-- Static institution data loads immediately -->
                        </div>
                    </div>
                </div>

                <!-- Banking Solutions Generator -->
                <div class="bg-white/70 backdrop-blur-lg dark:bg-gray-800/70 rounded-2xl shadow-xl border border-gray-200/50 dark:border-gray-700/50">
                    <div class="px-6 py-4 border-b border-gray-200/50 dark:border-gray-700/50">
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                            <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                            Banking Solutions Generator
                        </h2>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Target Institution</label>
                                <select id="targetInstitution" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                    <option value="">Select institution...</option>
                                </select>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Primary Market</label>
                                    <select id="primaryMarket" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                        <option value="hongkong">Hong Kong</option>
                                        <option value="singapore">Singapore</option>
                                        <option value="china">China</option>
                                        <option value="japan">Japan</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Institution Type</label>
                                    <select id="institutionType" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                        <option value="bank">International Bank</option>
                                        <option value="brokerdealer">Broker Dealer</option>
                                        <option value="fintech">Fintech</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Requirements</label>
                                <textarea id="requirements" placeholder="Describe banking service requirements..." rows="3" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"></textarea>
                            </div>

                            <button onclick="generateSolutions()" class="w-full bg-gradient-to-r from-primary to-purple-600 hover:from-primary-dark hover:to-purple-700 text-white px-4 py-3 rounded-lg font-medium transition-all shadow-lg">
                                Generate Banking Solutions
                            </button>
                        </div>

                        <div id="solutionsOutput" class="mt-6 space-y-4 hidden">
                            <h3 class="font-medium text-gray-900 dark:text-white">Generated Solutions:</h3>
                            <div id="solutionsContent" class="space-y-3"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Reports Section -->
            <div class="mt-8 bg-white/70 backdrop-blur-lg dark:bg-gray-800/70 rounded-2xl shadow-xl border border-gray-200/50 dark:border-gray-700/50">
                <div class="px-6 py-4 border-b border-gray-200/50 dark:border-gray-700/50">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                        <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Financial Reports & Asia Strategy Analysis
                    </h2>
                </div>
                <div class="p-6">
                    <div id="financialReports" class="space-y-4">
                        <!-- Static financial reports load immediately -->
                    </div>
                    <button onclick="analyzeFinancials()" class="mt-4 bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                        Refresh Analysis
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Static data for immediate display
        const institutions = [
            { name: "JPMorgan Chase", ticker: "JPM", type: "bank", country: "US", flag: "ðŸ‡ºðŸ‡¸", status: "active", markets: ["Hong Kong", "Singapore"], marketCap: "$450B" },
            { name: "Goldman Sachs", ticker: "GS", type: "bank", country: "US", flag: "ðŸ‡ºðŸ‡¸", status: "active", markets: ["Hong Kong", "Singapore"], marketCap: "$120B" },
            { name: "Bank of America", ticker: "BAC", type: "bank", country: "US", flag: "ðŸ‡ºðŸ‡¸", status: "active", markets: ["Hong Kong"], marketCap: "$280B" },
            { name: "Citigroup", ticker: "C", type: "bank", country: "US", flag: "ðŸ‡ºðŸ‡¸", status: "established", markets: ["Hong Kong", "Singapore", "China"], marketCap: "$110B" },
            { name: "Morgan Stanley", ticker: "MS", type: "brokerdealer", country: "US", flag: "ðŸ‡ºðŸ‡¸", status: "active", markets: ["Hong Kong", "Singapore"], marketCap: "$150B" },
            { name: "HSBC Holdings", ticker: "HSBC", type: "bank", country: "UK", flag: "ðŸ‡¬ðŸ‡§", status: "established", markets: ["Hong Kong", "Singapore", "China"], marketCap: "$140B" },
            { name: "Standard Chartered", ticker: "STAN", type: "bank", country: "UK", flag: "ðŸ‡¬ðŸ‡§", status: "established", markets: ["Hong Kong", "Singapore"], marketCap: "$20B" },
            { name: "Barclays", ticker: "BARC", type: "bank", country: "UK", flag: "ðŸ‡¬ðŸ‡§", status: "active", markets: ["Hong Kong"], marketCap: "$35B" },
            { name: "BNP Paribas", ticker: "BNP", type: "bank", country: "France", flag: "ðŸ‡«ðŸ‡·", status: "active", markets: ["Hong Kong", "Singapore"], marketCap: "$65B" },
            { name: "Deutsche Bank", ticker: "DB", type: "bank", country: "Germany", flag: "ðŸ‡©ðŸ‡ª", status: "active", markets: ["Hong Kong", "Singapore"], marketCap: "$25B" },
            { name: "UBS Group", ticker: "UBS", type: "bank", country: "Switzerland", flag: "ðŸ‡¨ðŸ‡­", status: "established", markets: ["Hong Kong", "Singapore"], marketCap: "$60B" },
            { name: "Credit Suisse", ticker: "CS", type: "bank", country: "Switzerland", flag: "ðŸ‡¨ðŸ‡­", status: "active", markets: ["Hong Kong"], marketCap: "$8B" }
        ];

        const financialReports = [
            {
                institution: "JPMorgan Chase",
                asiaRevenue: "25%",
                strategy: "Expanding private banking and wealth management across Hong Kong and Singapore",
                metrics: "$2.1B Asia revenue in Q3, 15% YoY growth",
                news: "Announced $500M Singapore hub investment"
            },
            {
                institution: "HSBC Holdings", 
                asiaRevenue: "65%",
                strategy: "Doubling down on wealth management and sustainable finance in Asia",
                metrics: "$8.7B Asia revenue, Asia-first strategy execution",
                news: "New sustainability finance initiatives launched"
            },
            {
                institution: "Goldman Sachs",
                asiaRevenue: "18%", 
                strategy: "Focus on investment banking and asset management in key markets",
                metrics: "$1.8B Asia revenue, strong M&A advisory pipeline",
                news: "Expanding Marcus digital banking platform"
            }
        ];

        // Initialize app immediately with static data
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('ðŸš€ Initializing app...');
                loadInstitutionDirectory();
                loadFinancialReports();
                populateInstitutionSelect();
                console.log('âœ… App initialized successfully');
            } catch (error) {
                console.error('âŒ Initialization error:', error);
                showError('Failed to initialize app: ' + error.message);
            }
        });

        function loadInstitutionDirectory() {
            const container = document.getElementById('institutionDirectory');
            if (!container) return;

            let html = '';
            institutions.forEach((inst) => {
                const statusColor = inst.status === 'active' ? 'bg-green-100 text-green-800' : 
                                  inst.status === 'established' ? 'bg-blue-100 text-blue-800' : 
                                  'bg-yellow-100 text-yellow-800';
                
                html += `
                <div class="institution-card bg-white dark:bg-gray-700 rounded-xl p-4 border border-gray-200 dark:border-gray-600 shadow-lg" onclick="analyzeInstitution('${inst.name}')">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-sm">
                                ${inst.ticker.substring(0,2)}
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900 dark:text-white">${inst.name} ${inst.flag}</h4>
                                <p class="text-xs text-gray-500 dark:text-gray-400">${inst.type.toUpperCase()} â€¢ ${inst.ticker}</p>
                            </div>
                        </div>
                        <span class="px-2 py-1 text-xs font-medium ${statusColor} rounded-full">
                            ${inst.status.toUpperCase()}
                        </span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-xs text-gray-600 dark:text-gray-400">
                        <div><strong>Market Cap:</strong> ${inst.marketCap}</div>
                        <div><strong>Markets:</strong> ${inst.markets.length}</div>
                    </div>
                    <div class="mt-2 flex flex-wrap gap-1">
                        ${inst.markets.map(market => `<span class="px-2 py-1 text-xs bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded">${market}</span>`).join('')}
                    </div>
                </div>`;
            });
            
            container.innerHTML = html;
            container.classList.add('fade-in');
        }

        function loadFinancialReports() {
            const container = document.getElementById('financialReports');
            if (!container) return;

            let html = '';
            financialReports.forEach((report) => {
                html += `
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-700 dark:to-gray-600 rounded-xl p-4 border border-blue-200 dark:border-gray-600">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-semibold text-gray-900 dark:text-white">${report.institution}</h4>
                        <span class="px-2 py-1 text-xs font-medium bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full">
                            ${report.asiaRevenue} Asia Revenue
                        </span>
                    </div>
                    <div class="space-y-2 text-sm text-gray-700 dark:text-gray-300">
                        <p><strong>Asia Strategy:</strong> ${report.strategy}</p>
                        <p><strong>Key Metrics:</strong> ${report.metrics}</p>
                        <p><strong>Recent News:</strong> ${report.news}</p>
                    </div>
                </div>`;
            });
            
            container.innerHTML = html;
            container.classList.add('fade-in');
        }

        function populateInstitutionSelect() {
            const select = document.getElementById('targetInstitution');
            if (!select) return;

            institutions.forEach(inst => {
                const option = document.createElement('option');
                option.value = inst.name;
                option.textContent = `${inst.name} (${inst.ticker})`;
                select.appendChild(option);
            });
        }

        // AI Enhancement Functions (with error handling)
        async function generateSolutions() {
            const institution = document.getElementById('targetInstitution')?.value;
            const market = document.getElementById('primaryMarket')?.value;
            const requirements = document.getElementById('requirements')?.value;

            if (!institution) {
                showError('Please select an institution');
                return;
            }

            const outputDiv = document.getElementById('solutionsOutput');
            const contentDiv = document.getElementById('solutionsContent');
            
            if (!outputDiv || !contentDiv) {
                showError('UI elements not found');
                return;
            }

            try {
                // Show loading state
                contentDiv.innerHTML = `
                <div class="flex items-center p-4">
                    <div class="loading-spinner"></div>
                    <span class="ml-3 text-gray-600 dark:text-gray-400">Generating banking solutions...</span>
                </div>`;
                outputDiv.classList.remove('hidden');

                // Check if Poe API is available
                if (typeof window.Poe === 'undefined') {
                    throw new Error('Poe API not available');
                }

                const prompt = `@Claude-Sonnet-4 Generate 3 practical banking solutions for ${institution} in ${market} market. Requirements: ${requirements || 'General banking services'}. Format as brief, actionable recommendations.`;
                
                await window.Poe.sendUserMessage(prompt, {
                    handler: "solutions-handler",
                    stream: false,
                    openChat: false
                });

            } catch (error) {
                console.error('Error generating solutions:', error);
                
                // Fallback to static solutions
                contentDiv.innerHTML = `
                <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800">
                    <h4 class="font-semibold text-gray-900 dark:text-white mb-2">Cash Management Optimization</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Streamline liquidity management across ${market} operations with multi-currency solutions.</p>
                </div>
                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
                    <h4 class="font-semibold text-gray-900 dark:text-white mb-2">Trade Finance Solutions</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Enhanced trade finance capabilities for Asia-Pacific corridor transactions.</p>
                </div>
                <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800">
                    <h4 class="font-semibold text-gray-900 dark:text-white mb-2">Securities Services</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Comprehensive custody and clearing services for ${market} market access.</p>
                </div>`;
                
                outputDiv.classList.remove('hidden');
            }
        }

        // Register Poe handler (if available)
        if (typeof window.Poe !== 'undefined') {
            window.Poe.registerHandler("solutions-handler", (result, context) => {
                const content = result.responses[0];
                const contentDiv = document.getElementById('solutionsContent');
                
                if (!contentDiv) return;

                if (content.status === "error") {
                    contentDiv.innerHTML = `<div class="text-red-600 dark:text-red-400">Error: ${content.statusText}</div>`;
                } else if (content.status === "complete") {
                    contentDiv.innerHTML = `<div class="prose dark:prose-invert max-w-none text-sm">${content.content.replace(/\n/g, '<br>')}</div>`;
                }
            });
        }

        async function analyzeInstitution(name) {
            try {
                if (typeof window.Poe !== 'undefined') {
                    await window.Poe.sendUserMessage(
                        `@Claude-Sonnet-4 Provide brief analysis of ${name}'s Asia strategy, recent performance, and expansion opportunities.`,
                        { openChat: true }
                    );
                } else {
                    showError(`Analysis feature requires AI integration. Institution: ${name}`);
                }
            } catch (error) {
                console.error('Error analyzing institution:', error);
                showError('Failed to analyze institution: ' + error.message);
            }
        }

        async function analyzeFinancials() {
            try {
                if (typeof window.Poe !== 'undefined') {
                    await window.Poe.sendUserMessage(
                        "@Claude-Sonnet-4 Analyze latest financial reports from major international banks focusing on Asia revenue, expansion strategies, and key developments.",
                        { openChat: true }
                    );
                } else {
                    showError('Financial analysis requires AI integration');
                }
            } catch (error) {
                console.error('Error analyzing financials:', error);
                showError('Failed to analyze financials: ' + error.message);
            }
        }

        function refreshData() {
            try {
                console.log('ðŸ”„ Refreshing data...');
                loadInstitutionDirectory();
                loadFinancialReports();
                showSuccess('Data refreshed successfully');
            } catch (error) {
                console.error('Error refreshing data:', error);
                showError('Failed to refresh data: ' + error.message);
            }
        }

        // Utility functions
        function showError(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4 border border-gray-200 dark:border-gray-700">
                    <div class="flex items-center mb-4">
                        <svg class="w-6 h-6 text-red-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Error</h3>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded-lg transition-colors" onclick="this.closest('.fixed').remove()">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (modal.parentNode) {
                    modal.parentNode.removeChild(modal);
                }
            }, 5000);
        }

        function showSuccess(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all';
            notification.innerHTML = `
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    ${message}
                </div>
            `;
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Error boundary for the entire app
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            showError('An unexpected error occurred. Please refresh the page.');
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            showError('An unexpected error occurred. Please refresh the page.');
        });
    </script>
</body>
</html>
